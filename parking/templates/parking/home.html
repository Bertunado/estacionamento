{% extends "parking/base.html" %}
{% load static %}

{% block title %}Smart Park{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'parking/css/style.css' %}">
<script src="{% static 'parking/css/js/chat_loader.js' %}" type="module"></script>

{% endblock %}

{% block content %}
<!-- Tabs -->
<div class="hidden md:flex border-b border-gray-200 container mx-auto w-full">
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600" data-tab="parkings">Vagas Dispon√≠veis</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="add-parking">Divulgar Vaga</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="my-parkings">Minhas Vagas</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="my-reservations">Minhas Reservas</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="requests">Solicita√ß√µes
    <span id="requests-count-badge" class="hidden ml-1 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full"></span>
</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="chat">Chat</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="profile">Perfil</button>
    <button class="tab-btn flex-1 text-center px-4 py-2 font-medium text-gray-500 hover:text-indigo-500" data-tab="settings">Configura√ß√µes</button>   
</div>

<!-- Parkings Tab -->
<div id="parkings" class="tab-content container mx-auto p-4">

    <div class="hidden md:block container mx-auto p-4">
        <div class="bg-white rounded-lg shadow-md p-4">
            <div class="flex flex-row space-x-4">
                
                <div class="w-1/2 flex flex-col">
                    <div>
                        <h3 class="text-lg font-semibold">Pesquisar Localiza√ß√£o</h3>
                        <div class="flex space-x-2 mt-2">
                            <input id="cepInputDesktop" type="text" placeholder="Digite seu endere√ßo ou CEP" class="border border-gray-300 rounded w-full p-2" />
                            <button id="buscarCepBtnDesktop" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700">
                            Buscar
                            </button>
                        </div>
                    </div>
                    <div class="map-container-desktop mt-4 rounded-lg shadow-md overflow-hidden relative flex-grow">
                        <div id="mapDesktop" class="w-full h-full" style="min-height: 550px;"></div>
                    </div>
                </div>

                <div class="w-1/2 flex flex-col">
                    <div class="flex-shrink-0">
                        <h3 class="text-lg font-semibold">Vagas Pr√≥ximas</h3>
                        <div class="flex space-x-2 mt-3 mb-4">
                            <select class="border border-gray-300 rounded px-2 py-2 text-sm w-2/3">
                                <option>Ordenar por: Dist√¢ncia</option>
                                <option>Ordenar por: Pre√ßo</option>
                                <option>Ordenar por: Avalia√ß√£o</option>
                            </select>
                            <button class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 flex items-center w-1/3 justify-center">
                                <i class="fas fa-filter mr-1"></i> 
                                <span>Filtrar</span>
                            </button>
                        </div>
                    </div>
                    <div id="parkingDesktop" class="flex-grow overflow-y-auto space-y-4" style="height: 550px;">
                        </div>
                </div>

            </div>
        </div>
    </div>

    <div class="block md:hidden">
        <div class="relative">
            
            <div class="absolute top-4 left-4 right-4 z-20">
                <div class="bg-white p-4 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold">Pesquisar Localiza√ß√£o</h3>
                    <div class="flex space-x-2 mt-2">
                        <input id="cepInput" type="text" placeholder="Digite seu endere√ßo ou CEP" class="border border-gray-300 rounded w-full p-2" />
                        <button id="buscarCepBtn" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700">
                        Buscar
                        </button>
                    </div>
                </div>
            </div>

            <div id="map-container" class="fixed inset-0 z-10">
                <div id="map" class="w-full h-full"></div> </div>

            <div id="parking-sheet" class="fixed bottom-[60px] left-0 right-0 z-30 transition-transform duration-300 ease-in-out">
                <div class="bg-white rounded-t-lg shadow-2xl h-[80vh] flex flex-col">
                    <div id="sheet-handle" class="w-full p-4 text-center cursor-pointer border-b">
                        <span class="inline-block w-10 h-1 bg-gray-300 rounded-full"></span>
                        <h3 id="sheet-title" class="font-semibold text-lg mt-2">Vagas Pr√≥ximas</h3>
                    </div>
                    <div class="sheet-content p-4 overflow-y-auto">
                        <div class="flex space-x-2 mb-4">
                            <select class="border border-gray-300 rounded px-2 py-2 text-sm w-2/3">
                                <option>Ordenar por: Dist√¢ncia</option>
                                <option>Ordenar por: Pre√ßo</option>
                                <option>Ordenar por: Avalia√ß√£o</option>
                            </select>
                            <button class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 flex items-center w-1s/3 justify-center">
                                <i class="fas fa-filter mr-1"></i> 
                                <span>Filtrar</span>
                            </button>
                        </div>
                        <div id="parking" class="space-y-4">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Parking Tab -->
<div id="add-parking" class="tab-content container mx-auto p-4">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Divulgar Nova Vaga</h2>
    
    <form id="addParkingForm">
      {% csrf_token %}
      <input type="hidden" id="latInput" name="latitude">
      <input type="hidden" id="lngInput" name="longitude">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="titleInput" class="block text-gray-700 font-medium mb-2">T√≠tulo da Vaga</label>
          <input
            type="text"
            id="titleInput"
            name="title"
            placeholder="Digite o t√≠tulo da vaga"
            class="border border-gray-300 rounded w-full p-2"
          />
          
          <label class="block text-gray-700 font-medium mb-2 mt-4">Endere√ßo</label>
          <input
            type="text"
            id="addressInput"
            name="address"
            placeholder="Digite a rua e n√∫mero"
            class="border border-gray-300 rounded w-full p-2"
            autocomplete="off"
          />

        <label for="tipo_vaga" class="block text-gray-700 font-medium mt-4 mb-2">Tipo de Vaga</label>
        <select id="tipo_vaga" name="tipo_vaga" class="w-full border border-gray-300 rounded px-3 py-2">
            <option value="rua_coberta">Rua (Coberta)</option>
            <option value="rua_descoberta">Rua (Descoberta)</option>
            <option value="garagem">Garagem</option>
            <option value="predio_coberta">Pr√©dio (Coberta)</option>
            <option value="predio_descoberta">Pr√©dio (Descoberta)</option>
        </select>

          <label class="block text-gray-700 font-medium mt-4 mb-2">Tamanho</label>
          <select name="size" id="sizeInput" class="border border-gray-300 rounded w-full p-2">
            <option>Pequeno (at√© 1.8m de largura)</option>
            <option>M√©dio (at√© 2.2m de largura)</option>
            <option>Grande (acima de 2.2m)</option>
          </select>

          <div class="mb-4">
            <label class="block text-gray-700 font-medium mt-4 mb-2">Definir Disponibilidade por Data:</label>
            <input type="text" id="availability-calendar" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Selecione as datas de disponibilidade">

            <div id="selected-dates-config" class="mt-4 space-y-4 p-4 border rounded-md bg-gray-50">
                <p id="no-dates-message" class="text-gray-500">Selecione as datas no calend√°rio acima para configurar os hor√°rios e vagas.</p>
            </div>
        </div>
        

    </div>
        <div>
          <label class="block text-gray-700 font-medium mb-2">Pre√ßo</label>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <span class="text-sm text-gray-600">Por hora</span>
              <div class="flex items-center border border-gray-300 rounded">
                <span class="px-3">R$</span>
                <input type="number" name="price_hour" id="priceHourInput" class="p-2 w-full border-0">
              </div>
            </div>
            <div>
              <span class="text-sm text-gray-600">Por dia</span>
              <div class="flex items-center border border-gray-300 rounded">
                <span class="px-3">R$</span>
                <input type="number" name="price_day" id="priceDayInput" class="p-2 w-full border-0">
              </div>
            </div>
          </div>

          <label class="block text-gray-700 font-medium mt-4 mb-2">Fotos da Vaga</label>
          <div id="photoDropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer">
            <i class="fas fa-camera text-3xl text-gray-400 mb-2"></i>
            <p>Arraste e solte fotos aqui ou clique para selecionar</p>
            <input id="photosInput" type="file" class="hidden" multiple accept="image/*">
            <div id="previewContainer" class="mt-2 flex flex-wrap justify-center gap-2"></div>
          </div>

          <label class="block text-gray-700 font-medium mt-4 mb-2">Descri√ß√£o</label>
          <textarea name="description" class="border border-gray-300 rounded w-full p-2 h-24" placeholder="Forne√ßa detalhes sobre a vaga..."></textarea>

          <div class="flex items-center mt-4">
            <input type="checkbox" class="mr-2">
            <span class="text-sm">Confirmo que sou o propriet√°rio/autorizado e que esta vaga n√£o viola nenhuma lei local</span>
          </div>

          
          <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded mt-6 w-full hover:bg-indigo-700">
            Publicar Vaga
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div id="my-reservations" class="tab-content container mx-auto p-4" data-display-flex="false">
    <div id="myReservationsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4"></div>
</div>


<div id="my-parkings" class="tab-content container mx-auto p-4">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Minhas Vagas Cadastradas</h2>
    <div id="myVagasContainer" class="space-y-4">
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex justify-between items-center">
          <div>
            <span class="text-green-600 bg-green-100 text-sm px-2 py-1 rounded">Ativa</span>
          </div>
        </div>

        <div class="mt-3 flex items-center justify-between">
          <div class="flex space-x-2">
            <button class="bg-indigo-600 text-white px-3 py-1 text-sm rounded hover:bg-indigo-700" data-id="${spot.id}" data-action="editar">Editar</button>
            <button class="bg-gray-100 text-gray-800 px-3 py-1 text-sm rounded hover:bg-gray-200">Ver Estat√≠sticas</button>
            <button class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700" data-id="${spot.id}" data-action="desativar"> Desativar</button>
            <button class="bg-red-100 text-red-600 px-3 py-1 text-sm rounded hover:bg-red-200 btn-excluir" data-id="${spot.id}" data-action="excluir">Excluir</button>
          </div>
        </div>
      </div>

      <!-- Nenhuma vaga cadastrada -->
      <p class="text-center text-gray-400 mt-6">Voc√™ ainda n√£o cadastrou nenhuma vaga.</p>
    </div>
  </div>
</div>

<!-- Chat Tab -->
<div id="chat" class="tab-content container mx-auto p-4">
    <div class="flex flex-col md:flex-row gap-6">
        <div class="w-full md:w-1/3 bg-white rounded-lg shadow-md overflow-hidden">
            <div class="p-4 border-b">
                <h2 class="text-xl font-semibold">Conversas Ativas</h2>
            </div>
            <ul id="conversation-list" class="divide-y divide-gray-200 overflow-y-auto h-[450px]">
                </ul>
        </div>

        <div id="chat-container" class="w-full md:w-2/3 bg-white rounded-lg shadow-md p-6 flex flex-col h-[500px]">
            <div id="initial-message" class="flex-grow flex items-center justify-center">
                <p class="text-gray-400 text-lg">Selecione uma conversa para come√ßar a conversar.</p>
            </div>
            
            <div id="chat-content" class="hidden flex-grow flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="chat-title" class="text-xl font-bold"></h2>
                    <button id="delete-chat-btn" class="text-red-500 hover:text-red-700 font-bold px-3 py-1 rounded-lg transition duration-200">
                        Excluir Conversa
                    </button>
                </div>
                
                <div id="msg-box" class="flex-grow overflow-y-auto border rounded p-4 bg-gray-50 mb-4">
                </div>
                
                <form id="msg-form" class="flex space-x-2">
                    {% csrf_token %}
                    <input name="text" type="text" placeholder="Digite sua mensagem" class="flex-grow border rounded p-2" autocomplete="off" />
                    <button type="submit" class="bg-indigo-600 text-white px-4 rounded hover:bg-indigo-700">Enviar</button>
                </form>
            </div>
            
            {{ user.id|json_script:"userIdData" }}
        </div>
    </div>
</div>

<!-- Profile Tab -->
<div id="profile" class="tab-content container mx-auto p-4">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-6">
            <div class="relative">
                {% if perfil.foto %}
                    <img src="{{ perfil.foto.url }}" alt="Foto de perfil" class="w-20 h-20 rounded-full object-cover">
                {% else %}
                    <img src="{{ MEDIA_URL }}fotos_perfil/anonimo.png" alt="Foto de perfil padr√£o" class="w-20 h-20 rounded-full object-cover">
                {% endif %}
                <button class="absolute bottom-0 right-0 bg-indigo-100 rounded-full p-1 hover:bg-indigo-200">
                    <i class="fas fa-camera text-indigo-600 text-sm"></i>
                </button>
            </div>
            
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h3 class="font-medium text-lg mb-4">Informa√ß√µes Pessoais</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-gray-600 text-sm">Nome Completo</label>
                        <input type="text" value="{{ perfil.nome_completo }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-600 text-sm">E-mail</label>
                        <input type="email" value="{{ perfil.usuario.email }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-600 text-sm">Telefone</label>
                        <input type="tel" value="{{ perfil.telefone }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                </div>
                
                <h3 class="font-medium text-lg mt-6 mb-4">Informa√ß√µes do Ve√≠culo</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-gray-600 text-sm">Modelo</label>
                        <input type="text" value="{{ perfil.modelo_veiculo }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-600 text-sm">Cor</label>
                        <input type="text" value="{{ perfil.cor_veiculo }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-600 text-sm">Placa</label>
                        <input type="text" value="{{ perfil.placa_veiculo }}" class="border-0 border-b border-gray-300 w-full p-1 bg-transparent">
                    </div>
                </div>
                
                <button class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
                    Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Tab -->
<div id="settings" class="tab-content container mx-auto p-4">
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-6">Configura√ß√µes</h2>
        
        <div class="space-y-6">
            <div>
                <h3 class="font-medium text-lg mb-3">Notifica√ß√µes</h3>
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span>Novas vagas na minha regi√£o</span>
                        <input type="checkbox" checked class="ml-4">
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Alertas de reservas</span>
                        <input type="checkbox" checked class="ml-4">
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Lembretes de pagamento</span>
                        <input type="checkbox" class="ml-4">
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Promo√ß√µes e ofertas</span>
                        <input type="checkbox" class="ml-4">
                    </div>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium text-lg mb-3">Pagamento</h3>
                <div class="bg-gray-50 p-4 rounded">
                    <div class="flex items-center">
                        <i class="far fa-credit-card text-xl mr-3"></i>
                        <span>Cart√£o finalizado em 1234</span>
                        <button class="ml-auto text-indigo-600 hover:text-indigo-800">Alterar</button>
                    </div>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium text-lg mb-3">Acessibilidade</h3>
                <div class="flex space-x-4">
                    <button class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50">
                        Modo para dalt√¥nicos
                    </button>
                    <button class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50">
                        Tamanho de fonte maior
                    </button>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium text-lg mb-3">Conta</h3>
                <div class="space-y-2">
                    <button class="text-left w-full p-2 text-red-600 hover:bg-red-50 rounded">
                        Desativar conta temporariamente
                    </button>
                    <button class="text-left w-full p-2 text-red-600 hover:bg-red-50 rounded">
                        Excluir conta permanentemente
                    </button>
                </div>
            </div>
            
            <button class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
                Salvar Configura√ß√µes
            </button>
        </div>
    </div> 
</div>

<div id="parking-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
        <div class="p-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="modal-parking-title">(Titulo da Vaga)</h3>
                <div class="bg-white rounded-lg w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="p-4">
                     <input type="hidden" id="reservation-spot-id">

                 </div>
                            </div>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/193711e1-47a8-44c3-86af-4c20ef678c94.png" alt="Vista ampla de garagem residencial com espa√ßo para um carro m√©dio e prateleiras de armazenamento" class="w-full h-48 object-cover rounded-lg mb-4" id="modal-parking-image">

                <div class="mb-4">
                    <p class="text-gray-800" id="modal-parking-address">(Endere√ßo da Vaga)</p>
                    <p class="text-gray-600 text-sm mt-1" id="modal-parking-description">(Descri√ß√£o da Vaga)</p>
                </div>

        <div class="my-3 border-t-2 border-gray-200 mx-4"></div>

<div class="flex items-center space-x-3 mb-4">
    <img 
        id="modal-seller-profile-image" 
        alt="Foto de perfil do vendedor" 
        class="h-12 w-12 rounded-full object-cover border-2 border-gray-300 cursor-pointer">
    <div>
        <div id="seller-info-popover" class="hidden absolute z-50 mt-2 p-4 bg-white rounded-xl shadow-lg border w-72 text-sm">
    <p class="font-semibold text-gray-800 text-base mb-1" id="popover-seller-name">Nome do Vendedor</p>
    <p class="text-gray-500 mb-2">üïí Conta criada h√° 2 anos</p>
    <p class="text-gray-500 mb-2">‚úÖ Identidade verificada</p>
    <p class="text-gray-500 mb-4">‚≠ê 42 avalia√ß√µes</p>

    <button class="flex items-center text-red-500 hover:underline text-sm">
        üö© <span class="ml-1">Denunciar usu√°rio</span>
    </button>
</div>
        <p id="modal-seller-name" class="text-base font-semibold text-gray-800">Nome do Vendedor</p>
        <p class="text-xs text-gray-400">Vendedor</p>
    </div>
</div>

<div class="my-3 border-t-2 border-gray-200 mx-4"></div>


            <div class="px-2 text-sm text-gray-700 mb-4">
                <div class="flex items-center mb-1">
                    <i class="fa-solid fa-building fa-fw text-gray-600 mr-2"></i> <span id="modal-parking-type-display">Tipo: --</span>
                </div>
                <div class="flex items-center mb-1">
                    <i class="fa-solid fa-ruler fa-fw text-gray-600 mr-2"></i> <span id="modal-parking-size-display">Tamanho: --</span>
                </div>
                <div class="flex items-center mb-1">
                    <i class="fa-regular fa-clock fa-fw text-gray-600 mr-2"></i> <span id="modal-parking-hours-display">Dispon√≠vel: --</span>
                </div>
                <div class="flex items-center mb-1">
                    <i class="fa-solid fa-camera fa-fw text-gray-600 mr-2"></i> <span id="modal-parking-camera-display">C√¢mera de Seguran√ßa: --</span>
                </div>
                <div class="flex items-center">
                    <i class="fa-solid fa-dollar-sign fa-fw text-gray-600 mr-2"></i> <span id="modal-parking-price-display">Pre√ßo por hora: --</span>
                </div>
            </div>

            <div class="flex items-center">
                <span class="text-yellow-500">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                <span class="text-gray-500 text-sm ml-1">(12 avalia√ß√µes)</span>
            </div>

            <div class="my-3 border-t-2 border-gray-200 mx-4"></div>


            <div class="mb-4">
                <label for="reservation-calendar" class="block text-sm font-medium text-gray-700">Selecione as Datas da Reserva</label>
                <input type="text" id="reservation-calendar" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Clique para selecionar as datas">
                <div id="selected-reservation-dates-display" class="mt-2 text-sm text-gray-500">Nenhuma data selecionada ainda.</div>
            </div>

            <div id="available-slots-for-date" class="hidden mt-4">
                <h3 class="font-semibold text-gray-800 mb-2">Vagas Dispon√≠veis para as Datas Selecionadas:</h3>
                <div id="dynamic-vaga-squares" class="flex flex-wrap gap-2"></div>
                <p id="no-slots-message" class="text-gray-500 text-sm mt-2">Selecione uma data para ver as vagas dispon√≠veis.</p>
            </div>

            <div id="reserved-slots-for-date" class="hidden mt-4">
                <h3 class="font-semibold text-gray-800 mb-2">Hor√°rios Ocupados:</h3>
                    <div id="reserved-slots-list" class="space-y-2 text-sm text-gray-600"></div>
                    <p id="no-reserved-slots-message" class="text-gray-500 text-sm mt-2">Nenhum hor√°rio reservado para a data selecionada.</p>
            </div>

            

           <div id="selected-slot-details-section" class="hidden bg-gray-50 rounded-lg p-4 mb-4">
                <h3 class="font-semibold text-gray-800 mb-2">Detalhes da Vaga Escolhida:</h3>
                <p class="text-gray-700 mb-1">N√∫mero da vaga: <span id="selected-slot-number" class="font-bold">--</span></p>
                <p class="text-gray-700 mb-1">Data da vaga: <span id="selected-slot-date-display" class="font-bold">--/--/----</span></p>

                <div class="mb-4">
                    <label for="start-time-input" class="block text-sm font-medium text-gray-700">Hor√°rio de entrada:</label>
                    <input type="text" id="start-time-input" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="HH:MM">
                </div>

                <div class="mb-4">
                    <label for="end-time-input" class="block text-sm font-medium text-gray-700">Hor√°rio de sa√≠da:</label>
                    <input type="text" id="end-time-input" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="HH:MM">
                </div>

                <p id="time-overlap-error" class="text-sm text-red-600 mt-2 hidden"></p>


                <p class="text-gray-700 font-semibold mb-3">Como voc√™ deseja reservar?</p>

                <div id="reservation-option-hourly" class="reservation-option bg-gray-100 rounded-lg p-4 mb-4 relative
                                cursor-pointer transition-all duration-300 ease-in-out
                                hover:scale-[1.02] hover:shadow-lg">
                    <span class="absolute top-2 left-2 text-xs font-bold text-gray-600 bg-gray-200 px-2 py-1 rounded">Por hora</span>
                    <div class="flex justify-between mb-2 mt-4">
                        <span class="text-gray-700">Valor por hora:</span>
                        <span class="font-bold" id="hourly-price">R$ --,--</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-700">Total de horas:</span>
                        <span class="font-bold" id="total-hours">0</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg">
                        <span>Total:</span>
                        <span id="total-price">R$ 0,00</span>
                    </div>
                    <div class="selection-indicator absolute top-0 right-0 w-8 h-8 rounded-tr-lg
                                    flex items-center justify-center text-white text-xs font-bold
                                    bg-purple-600 transform translate-x-1/2 -translate-y-1/2 scale-0 opacity-0
                                    transition-all duration-300 ease-in-out">
                        ‚úì
                    </div>
                </div>

                <p class="text-center text-gray-600 font-semibold mb-4">Ou</p>

                <div id="reservation-option-daily" class="reservation-option bg-gray-100 rounded-lg p-4 relative
                                cursor-pointer transition-all duration-300 ease-in-out
                                hover:scale-[1.02] hover:shadow-lg">
                    <span class="absolute top-2 left-2 text-xs font-bold text-gray-600 bg-gray-200 px-2 py-1 rounded">Por dia</span>
                    <div class="flex justify-between mb-2 mt-4">
                        <span class="text-gray-700">Valor pelo dia:</span>
                        <span class="font-bold" id="daily-price">R$ --,--</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-700">Hor√°rio de entrada e sa√≠da:</span>
                        <span class="font-bold" id="daily-times">--:-- at√© --:--</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg">
                        <span>Total:</span>
                        <span id="daily-total-price">R$ 0,00</span>
                    </div>
                    <div class="selection-indicator absolute top-0 right-0 w-8 h-8 rounded-tr-lg
                                    flex items-center justify-center text-white text-xs font-bold
                                    bg-purple-600 transform translate-x-1/2 -translate-y-1/2 scale-0 opacity-0
                                    transition-all duration-300 ease-in-out">
                        ‚úì
                    </div>
                </div>
            </div>
                <div class="mt-6 flex justify-end space-x-3">
                <button id="close-modal" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancelar</button>
                <button id="confirm-reservation-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Confirmar Reserva</button>
            </div>
        </div>
    </div>
</div> 
                    
            <!-- Reservation Confirmation Modal -->
           <div id="reservation-confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg w-full max-w-md mx-4 p-6">
        <div class="text-center mb-6">
            
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-indigo-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            
            <h3 class="text-xl font-bold text-gray-800 mb-2">Sua reserva est√° pendente</h3>
            
            <p class="text-gray-600">Avisaremos assim que o vendedor confirmar.</p>
        </div>
        
        <div class="bg-gray-100 rounded-lg p-4 mb-6">
            <div class="flex justify-between mb-2">
                <span class="text-gray-700">Tipo:</span>
                <span class="font-bold" id="confirmation-location">Garagem residencial</span>
            </div>
            <div class="flex justify-between mb-2">
                <span class="text-gray-700">Data:</span>
                <span class="font-bold" id="confirmation-date">15/06/2023</span>
            </div>
            <div class="flex justify-between mb-2">
                <span class="text-gray-700">Hor√°rio:</span>
                <span class="font-bold" id="confirmation-time">14:00 - 17:00</span>
            </div>
            <div class="flex justify-between mb-2">
                <span class="text-gray-700">Vaga:</span>
                <span class="font-bold" id="confirmation-spot">Vaga A1</span>
            </div>
            <div class="flex justify-between font-bold text-lg mt-3 pt-2 border-t border-gray-300">
                <span>Total:</span>
                <span id="confirmation-total">R$ 24,00</span>
            </div>
        </div>
        
        <button id="close-confirmation-btn" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition duration-200">
            Fechar
        </button>
    </div>
</div>
    
<div id="reservation-detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto">
    <div class="relative top-10 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center pb-3">
            <h3 class="text-xl font-semibold text-gray-900">Detalhes da sua Reserva</h3>
            <button id="close-reservation-modal" class="text-gray-400 hover:text-gray-600">&times;</button>
        </div>
        
        <div class="mt-2 text-gray-700">
            <img id="modal-reservation-image" src="" alt="Foto da Vaga" class="w-full h-48 object-cover rounded mb-4">
            
            <h4 id="modal-reservation-title" class="text-lg font-bold mb-1"></h4>
            <p id="modal-reservation-address" class="text-sm text-gray-500 mb-4"></p>
            
            <hr class="my-4">
            
            <div class="flex items-center text-gray-600 mb-2">
                <i class="fa-regular fa-calendar-alt fa-fw mr-2"></i>
                <span id="reservation-date-display" class="font-medium"></span>
            </div>
            
            <div class="flex items-center text-gray-600 mb-2">
                <i class="fa-regular fa-clock fa-fw mr-2"></i>
                <span id="reservation-time-display" class="font-medium"></span>
            </div>
            
            <div class="flex items-center text-gray-600 mb-2">
                <i class="fa-solid fa-hashtag fa-fw mr-2"></i>
                <span id="reservation-slot-number-display" class="font-medium"></span>
            </div>
            
            <div class="flex items-center text-gray-600 mb-2">
                <i class="fa-solid fa-brazilian-real-sign fa-fw mr-2"></i>
                <span id="reservation-total-price-display" class="font-medium"></span>
            </div>

            <hr class="my-4">
            <div class="flex flex-col items-center justify-center space-y-4">
                <div id="reservation-map" class="w-full h-48 rounded-md bg-gray-200">
            </div>
                <button id="start-route-button" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 w-full text-center font-semibold">
                    Iniciar Rota
                </button>
                <button id="cancel-reservation-btn" class="bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition duration-200 w-full text-center font-semibold">
        Cancelar Reserva
    </button>
</div>
            </div>

            

            <hr class="my-4">

            <div class="flex items-center space-x-2">
                <img id="modal-seller-profile-image-detail" alt="Foto do Vendedor" class="w-10 h-10 rounded-full object-cover">
                <p class="text-gray-500">Vendedor: <span id="modal-seller-name-detail" class="font-semibold text-gray-700"></span></p>
            </div>
            <div id="chat-button-container"></div>

        </div>
    </div>
</div>



<!-- Botoes -->
<div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-80 p-6">
        <div class="text-center mb-4">
            <h3 class="text-xl font-medium text-gray-800">Confirma√ß√£o de Exclus√£o</h3>
            <p class="modal-message-placeholder text-base text-gray-700 mt-2">Tem certeza que deseja excluir essa vaga?</p>
        </div>
        <div class="flex justify-center space-x-4">
            <button id="confirm-delete" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Confirmar</button>
            <button id="cancel-delete" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
        </div>
    </div>
</div>

<div id="delete-success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-80 p-6">
        <div class="text-center mb-6">
            <h3 class="text-xl font-medium text-gray-800">Sucesso!</h3>
            <p class="modal-message-placeholder text-base text-gray-700 mt-2">Vaga exclu√≠da com sucesso!</p>
        </div>
        <div class="flex justify-center">
            <button id="success-ok" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">OK</button>
        </div>
    </div>
</div>

<div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-80 p-6">
        <div class="text-center mb-6">
            <h3 class="text-xl font-medium text-red-600">Erro!</h3>
            <p class="modal-message-placeholder text-base text-gray-700 mt-2">Ocorreu um erro inesperado.</p>
        </div>
        <div class="flex justify-center">
            <button id="error-ok" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">OK</button>
        </div>
    </div>
</div>

<div id="success-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
        <h3 class="text-xl font-semibold mb-4 text-green-700">Sucesso!</h3>
        <p id="success-message" class="mb-6 text-gray-700">Vaga publicada com sucesso!</p>
        <button id="success-ok-button" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">OK</button>
    </div>
</div>

<div id="deactivate-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl w-80 p-6">
    <div class="text-center mb-4">
      <h3 class="text-xl font-medium text-gray-800">Confirma√ß√£o de A√ß√£o</h3>
      <p class="modal-message-placeholder text-base text-gray-700 mt-2">Deseja desativar essa vaga?</p>
    </div>
    <div class="flex justify-center space-x-4">
      <button id="confirm-deactivate" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Confirmar</button>
      <button id="cancel-deactivate" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
    </div>
  </div>
</div>

<div id="delete-chat-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Confirmar Exclus√£o</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500">
                    Voc√™ tem certeza que deseja excluir esta conversa? Esta a√ß√£o n√£o pode ser desfeita.
                </p>
            </div>
            <div class="items-center px-4 py-3">
                <button id="confirm-delete-btn"
                        class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    Excluir
                </button>
                <button id="cancel-delete-btn"
                        class="mt-3 px-4 py-2 bg-gray-200 text-gray-700 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
</div>

<div id="custom-confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 w-80">
        <h3 class="text-xl font-bold mb-4 text-gray-800">Confirma√ß√£o</h3>
        <p id="confirm-message" class="text-gray-600 mb-6">Tem certeza que deseja continuar com esta a√ß√£o?</p>
        <div class="flex justify-end space-x-4">
            <button id="cancel-confirm-btn" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition duration-200">
                N√£o, voltar
            </button>
            <button id="proceed-confirm-btn" class="px-4 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition duration-200">
                Sim, cancelar
            </button>
        </div>
    </div>
</div>

<div id="toast-notification" class="fixed bottom-6 right-6 p-4 rounded-md text-white shadow-lg transition-all duration-300 transform translate-y-full opacity-0 z-50">
    <div id="toast-message"></div>
</div>

<div id="edit-spot-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl w-96">
    <h2 class="text-xl font-semibold mb-4">Editar Vaga</h2>
    <form id="editParkingForm" class="space-y-3">
      <input type="hidden" id="edit-spot-id" name="edit-spot-id">

      <label class="block text-sm font-medium text-gray-700">T√≠tulo</label>
      <input type="text" id="edit-title" name="edit-title" class="w-full border px-3 py-2 rounded" required>

      <div>
          <label for="edit-address" class="block text-sm font-medium text-gray-700">Endere√ßo</label>
          <input type="text" id="edit-address" name="edit-address" required
                 class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
      </div>
      <label class="block text-sm font-medium text-gray-700">Descri√ß√£o</label>
      <textarea id="edit-description" name="edit-description" class="w-full border px-3 py-2 rounded" required></textarea>

      <label class="block text-sm font-medium text-gray-700">Pre√ßo por hora</label>
      <input type="number" id="edit-price_hour" name="edit-price_hour" class="w-full border px-3 py-2 rounded" step="0.01" required>

      <label class="block text-sm font-medium text-gray-700">Pre√ßo por dia</label>
      <input type="number" id="edit-price_day" name="edit-price_day" class="w-full border px-3 py-2 rounded" step="0.01" required>

      <div>
          <label for="edit-size" class="block text-sm font-medium text-gray-700">Tamanho da Vaga</label>
          <select id="edit-size" name="edit-size"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
              <option value="Pequeno">Pequeno</option>
              <option value="M√©dio">M√©dio</option>
              <option value="Grande">Grande</option>
              <option value="Indefinido">Indefinido</option> </select>
      </div>

      <div>
          <label for="edit-tipo_vaga" class="block text-sm font-medium text-gray-700">Tipo de Vaga</label>
          <select id="edit-tipo_vaga" name="edit-tipo_vaga"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
              <option value="Carro">Carro</option>
              <option value="Moto">Moto</option>
              <option value="Caminh√£o">Caminh√£o</option>
              </select>
      </div>
      <div class="flex justify-end space-x-2 mt-4">
        <button type="button" id="cancel-edit" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Salvar</button>
      </div>
    </form>
  </div>
</div>

<div id="requests" class="tab-content container mx-auto p-4">
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Solicita√ß√µes de Reserva Pendentes</h2>
        
        <div id="requestsContainer" class="space-y-6">
            </div>

        <p id="no-requests-message" class="text-center text-gray-500 mt-6 hidden">
            Voc√™ n√£o tem nenhuma solicita√ß√£o de reserva pendente.
        </p>
    </div>
</div>

{% endblock %}